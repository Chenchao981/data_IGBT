# DVDS数据清洗项目 - 任务规划

## 项目概述

将ASEData/DVDS目录下的所有xlsx测试数据文件清洗整理成统一格式的DVDS数据文件。

## 目标

- 输入：`.\ASEData\DVDS\` 目录下所有xlsx文件
- 输出：`DVDS_[时间戳].xlsx` 文件，包含三列：NUM, lot ID, DVDS(mV)

## 项目结构

```
data_IGBT/
├── ASEData/DVDS/           # 源数据目录
├── output/                 # 输出目录
├── dvds_processing/        # DVDS处理专用文件夹
│   ├── dvds_cleaner.py    # 主程序文件
│   ├── todo_DVDS.md       # 本文档
│   ├── dvds_core_logic.md # 核心代码说明文档
│   ├── test_extract.py    # 测试脚本
│   └── dvds_cleaner.log   # 运行日志
├── sample/                 # 示例数据目录
└── requirements.txt       # 依赖包列表
```

## 核心模块设计

### 1. 文件扫描模块 (scan_dvds_files)

- **功能**：扫描DVDS目录下所有xlsx文件
- **输入**：目录路径
- **输出**：文件路径列表
- **状态**：✅ 已完成

### 2. 批次信息提取模块 (extract_batch_info)

- **功能**：从文件名中提取批次信息
- **输入**：文件路径
- **输出**：批次字符串（使用正则表达式提取FA4Z-2484模式）
- **提取规则**：使用正则表达式 `[A-Z0-9]{4}-[0-9]{4}`提取，如匹配失败则回退到完整文件名
- **状态**：✅ 已完成

### 3. 数据定位与提取模块 (extract_dvds_data)

- **功能**：从单个xlsx文件中提取DVDS数据
- **输入**：单个xlsx文件路径
- **输出**：DataFrame包含DVDS数值和文件名
- **关键逻辑**：定位第2行DVDS列，第7行单位，第20行开始提取数据
- **状态**：✅ 已完成

### 4. 数据汇总模块 (merge_all_data)

- **功能**：合并所有文件的数据
- **输入**：多个DataFrame
- **输出**：统一的DataFrame
- **状态**：✅ 已完成

### 5. 数据清洗模块 (clean_and_format)

- **功能**：数据清洗和格式化
- **输入**：原始合并数据
- **输出**：清洗后的标准格式数据
- **状态**：✅ 已完成

### 6. 输出模块 (save_result)

- **功能**：保存最终结果
- **输入**：清洗后的数据
- **输出**：xlsx文件
- **状态**：✅ 已完成

## 任务安排

### Phase 1: 基础框架搭建

- [X] 创建主程序文件结构
- [X] 设置依赖环境 (pandas, openpyxl)
- [X] 创建核心代码说明文档
- [X] 实现文件扫描功能

### Phase 2: 核心数据提取

- [ ] 实现单文件数据提取逻辑
- [ ] 测试"Test No."行定位
- [ ] 测试DVDS列数据提取
- [ ] 处理异常情况（文件格式不符等）

### Phase 3: 数据处理与合并

- [ ] 实现数据汇总功能
- [ ] 实现连续编号NUM生成
- [ ] 实现数据清洗功能
- [ ] 测试数据完整性

### Phase 4: 输出与优化

- [ ] 实现输出功能
- [ ] 添加时间戳生成
- [ ] 性能优化
- [ ] 错误处理完善

### Phase 5: 测试与文档

- [ ] 全流程测试
- [ ] 边界情况测试
- [ ] 用户使用说明
- [ ] 代码注释完善

## 技术要求

- **语言**：Python 3.x
- **主要依赖**：pandas, openpyxl
- **GUI框架**：如需要界面，使用PyQt5
- **开发环境**：Windows 11

## 开发进度

### 2025-06-18

- [X] **lot_ID提取逻辑重构**
  - [X] 将批次信息提取从完整文件名改为正则表达式提取
  - [X] 实现正则表达式 `[A-Z0-9]{4}-[0-9]{4}`匹配FA4Z-2484模式
  - [X] 添加 `extract_batch_info`方法处理lot_ID提取
  - [X] 添加匹配失败时回退到完整文件名的容错机制
  - [X] 测试验证提取逻辑正确性
  - [X] 生成新的DVDS数据文件，lot_ID正确显示为"FA4Z-2484"
  - [X] 成功处理12714行数据，输出格式：NUM | lot_ID | DVDS(mV)

### 2025-06-23

- [X] 项目需求分析完成
- [X] 创建todo文档
- [X] Phase 1开发完成
  - [X] 创建专门的dvds_processing文件夹
  - [X] 实现DVDSCleaner类基础框架
  - [X] 实现scan_dvds_files文件扫描功能
  - [X] 基础测试通过（成功找到2个xlsx文件）
  - [X] 更新文档状态

## 注意事项

1. 处理Excel文件时注意编码问题
2. 确保"Test No."行定位的准确性
3. DVDS列可能包含非数值数据，需要过滤
4. 使用正则表达式 `[A-Z0-9]{4}-[0-9]{4}`从文件名中提取lot_ID（如FA4Z-2484）
5. NUM列要跨文件保持连续编号

## 测试用例

- 测试单个文件处理
- 测试批量文件处理
- 测试空文件夹情况
- 测试文件格式异常情况
- 测试大量文件处理性能
